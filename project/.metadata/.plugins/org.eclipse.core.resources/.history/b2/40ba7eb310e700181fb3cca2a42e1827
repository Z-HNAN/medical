package cn.edu.hdu.zhn.medical.base.service.impl;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import cn.edu.hdu.zhn.medical.base.domain.ComDept;
import cn.edu.hdu.zhn.medical.base.mapper.ComDeptMapper;
import cn.edu.hdu.zhn.medical.base.service.IComDeptService;
import cn.edu.hdu.zhn.medical.base.vo.FullComDeptVO;
import cn.edu.hdu.zhn.medical.base.vo.FullComDeptVOVO;

@Service
public class ComDeptServiceImpl implements IComDeptService{

	@Autowired
	private ComDeptMapper comDeptMapper;
	
	@Override
	public ComDept get(Long comDeptId) {
		return this.comDeptMapper.selectByPrimaryKey(comDeptId);
	}

	@Override
	public int getCountByComDeptType(int comDeptType) {
		return this.comDeptMapper.getCountByComDeptType(comDeptType);
	}

	@Override
	public List<FullComDeptVO> getFullComDeptVO() {
		// 获取所有的公司信息
		int comAmount = this.comDeptMapper.getCountByComDeptType(ComDept.TYPE_COM);
		if(comAmount == 0) {
			// 没有公司  返回一个空集合就可以
			return new ArrayList<FullComDeptVOVO>();
		}
		
		// 存储结果的list
		ArrayList<FullComDeptVOVO> comDepts = new ArrayList<>(comAmount);
		List<ComDept> listCom =  this.comDeptMapper.listCom();
		// 循环得出每一个公司下属的部门信息
		for (ComDept comDept : listCom) {
			// 根据公司查询 其下属的部门
			List<ComDept> depts = this.comDeptMapper.listDeptByParentComId(comDept.getId());
			// 封装到FullComDeptVO里面
			FullComDeptVO FullComDeptVO = new FullComDeptVO();
			FullComDeptVO.setCom(comDept);
			FullComDeptVO.setDepts(depts);
			// 装箱到 comDeps里面
			comDepts.add(FullComDeptVO);
		}
		
		// 完成操作 返回此FullComDeptVO 即可
		return comDepts;
	}

	
	
}
